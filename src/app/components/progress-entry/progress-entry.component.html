<div class="progress-entry-modal" *ngIf="isVisible">
  <div class="modal-backdrop" (click)="onClose()"></div>
  
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">
        <i class="fas fa-dumbbell"></i>
        Log Workout Progress
      </h3>
      <button type="button" class="btn-close" (click)="onClose()" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Program Info -->
      <div class="program-info" *ngIf="program">
        <div class="program-header">
          <h4>{{ program.name }}</h4>
          <span class="difficulty-badge" [class]="'difficulty-' + program.difficulty">
            {{ program.difficulty }}
          </span>
        </div>
        <p class="program-description" *ngIf="program.description">
          {{ program.description }}
        </p>
        <div class="program-stats">
          <span class="stat">
            <i class="fas fa-dumbbell"></i>
            {{ program.exercises.length }} exercises
          </span>
          <span class="stat">
            <i class="fas fa-clock"></i>
            {{ program.metadata.estimatedDuration }} min
          </span>
        </div>
      </div>

      <!-- Progress Form -->
      <form [formGroup]="progressForm" class="progress-form">
        <!-- Workout Date -->
        <div class="form-group">
          <label for="workoutDate">Workout Date</label>
          <input 
            type="date" 
            id="workoutDate"
            formControlName="workoutDate"
            class="form-control"
            [max]="today"
          />
        </div>

        <!-- Exercises -->
        <div class="exercises-section">
          <h5>Exercise Progress</h5>
          
          <div class="exercise-item" *ngFor="let exercise of exercisesArray.controls; let exerciseIndex = index">
            <div class="exercise-header">
              <h6>{{ exercise.value.exerciseName }}</h6>
              <span class="exercise-order">Exercise {{ exerciseIndex + 1 }}</span>
            </div>

            <!-- Sets -->
            <div class="sets-container">
              <div class="set-item" *ngFor="let set of getSetsArray(exerciseIndex).controls; let setIndex = index">
                <div class="set-header">
                  <span class="set-number">Set {{ setIndex + 1 }}</span>
                  <div class="set-completed">
                    <input 
                      type="checkbox" 
                      [formControl]="getSetControl(exerciseIndex, setIndex, 'completed')"
                      id="completed-{{exerciseIndex}}-{{setIndex}}"
                    />
                    <label for="completed-{{exerciseIndex}}-{{setIndex}}">Completed</label>
                  </div>
                </div>

                <div class="set-inputs" [formGroup]="getSetGroup(exerciseIndex, setIndex)">
                  <div class="input-group">
                    <label for="weight-{{exerciseIndex}}-{{setIndex}}">Weight (kg)</label>
                    <input 
                      type="number" 
                      id="weight-{{exerciseIndex}}-{{setIndex}}"
                      formControlName="weight"
                      class="form-control"
                      min="0"
                      max="1000"
                      step="0.5"
                    />
                  </div>

                  <div class="input-group">
                    <label for="reps-{{exerciseIndex}}-{{setIndex}}">Reps</label>
                    <input 
                      type="number" 
                      id="reps-{{exerciseIndex}}-{{setIndex}}"
                      formControlName="reps"
                      class="form-control"
                      min="1"
                      max="100"
                    />
                  </div>

                  <div class="input-group">
                    <label for="restTime-{{exerciseIndex}}-{{setIndex}}">Rest Time (sec)</label>
                    <input 
                      type="number" 
                      id="restTime-{{exerciseIndex}}-{{setIndex}}"
                      formControlName="restTime"
                      class="form-control"
                      min="0"
                      max="600"
                    />
                  </div>
                </div>

                <div class="set-notes">
                  <input 
                    type="text" 
                    [formControl]="getSetControl(exerciseIndex, setIndex, 'notes')"
                    placeholder="Notes for this set (optional)"
                    class="form-control"
                  />
                </div>
              </div>
            </div>

            <!-- Exercise Notes -->
            <div class="exercise-notes">
              <textarea 
                [formControl]="getExerciseControl(exerciseIndex, 'notes')"
                placeholder="Notes for this exercise (optional)"
                class="form-control"
                rows="2"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Workout Rating -->
        <div class="form-group">
          <label for="rating">Workout Rating (1-5)</label>
          <div class="rating-input">
            <div class="rating-stars">
              <button 
                type="button" 
                class="star-btn" 
                *ngFor="let star of [1,2,3,4,5]"
                [class.active]="progressForm.get('rating')?.value >= star"
                (click)="progressForm.patchValue({rating: star})"
                [attr.aria-label]="'Rate ' + star + ' stars'"
              >
                <i class="fas fa-star"></i>
              </button>
            </div>
            <input 
              type="number" 
              id="rating"
              formControlName="rating"
              class="form-control"
              min="1"
              max="5"
              placeholder="Rate your workout"
            />
          </div>
        </div>

        <!-- Workout Notes -->
        <div class="form-group">
          <label for="workoutNotes">Workout Notes</label>
          <textarea 
            id="workoutNotes"
            formControlName="notes"
            placeholder="How did this workout feel? Any notes or observations..."
            class="form-control"
            rows="3"
          ></textarea>
        </div>

        <!-- Validation Errors -->
        <div class="validation-errors" *ngIf="validationErrors.length > 0">
          <div class="alert alert-danger">
            <h6><i class="fas fa-exclamation-triangle"></i> Please fix the following errors:</h6>
            <ul>
              <li *ngFor="let error of validationErrors">{{ error }}</li>
            </ul>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="onCancel()"
        [disabled]="loading"
      >
        <i class="fas fa-times"></i> Cancel
      </button>
      
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="onSave()"
        [disabled]="loading || !progressForm.valid"
      >
        <i class="fas fa-save" *ngIf="!loading"></i>
        <div class="spinner-border spinner-border-sm" *ngIf="loading"></div>
        {{ loading ? 'Saving...' : 'Save Progress' }}
      </button>
    </div>
  </div>
</div>
