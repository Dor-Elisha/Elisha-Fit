<div class="profile-page">
  <!-- Breadcrumb -->
  <app-breadcrumb></app-breadcrumb>

  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar">
      <div class="avatar-container">
        <i class="fas fa-user"></i>
      </div>
      <button class="avatar-edit-btn" title="Change photo">
        <i class="fas fa-camera"></i>
      </button>
    </div>
    
    <div class="profile-info">
      <h1 class="profile-name">{{ profileData.name || 'Your Name' }}</h1>
      <p class="profile-email">{{ profileData.email }}</p>
      <div class="profile-badges">
        <!-- Removed achievement summary and badge count -->
      </div>
    </div>
    
    <div class="profile-actions">
      <button 
        *ngIf="!editing" 
        class="btn btn-fitness" 
        (click)="enableEdit()">
        <i class="fas fa-edit me-2"></i>
        Edit Profile
      </button>
      <div *ngIf="editing" class="edit-actions">
        <button class="btn btn-success me-2" (click)="saveProfile()">
          <i class="fas fa-save me-2"></i>
          Save
        </button>
        <button class="btn btn-outline-secondary" (click)="cancelEdit()">
          <i class="fas fa-times me-2"></i>
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Profile Tabs -->
  <div class="profile-tabs">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button 
          class="nav-link" 
          [class.active]="activeTab === 'profile'"
          (click)="activeTab = 'profile'"
          type="button">
          <i class="fas fa-user me-2"></i>
          Profile
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button 
          class="nav-link" 
          [class.active]="activeTab === 'stats'"
          (click)="activeTab = 'stats'"
          type="button">
          <i class="fas fa-chart-bar me-2"></i>
          Statistics
        </button>
      </li>
      <!-- Removed Achievements tab -->
      <!-- <li class="nav-item" role="presentation">
        <button 
          class="nav-link" 
          [class.active]="activeTab === 'achievements'"
          (click)="activeTab = 'achievements'"
          type="button">
          <i class="fas fa-trophy me-2"></i>
          Achievements
        </button>
      </li> -->
      <li class="nav-item" role="presentation">
        <button 
          class="nav-link" 
          [class.active]="activeTab === 'settings'"
          (click)="activeTab = 'settings'"
          type="button">
          <i class="fas fa-cog me-2"></i>
          Settings
        </button>
      </li>
    </ul>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Profile Tab -->
    <div *ngIf="activeTab === 'profile'" class="profile-content">
      <div class="profile-grid">
        <!-- Personal Information -->
        <div class="profile-section">
          <h3 class="section-title">Personal Information</h3>
          <form [formGroup]="profileForm" class="profile-form">
            <div class="form-row">
              <div class="form-group">
                <label for="name" class="form-label">Full Name *</label>
                <input
                  id="name"
                  type="text"
                  class="form-control"
                  formControlName="name"
                  placeholder="Enter your full name"
                  [class.is-invalid]="isFieldInvalid(profileForm, 'name')"
                  [disabled]="!editing"
                />
                <div *ngIf="isFieldInvalid(profileForm, 'name')" class="invalid-feedback">
                  {{ getFieldError(profileForm, 'name') }}
                </div>
              </div>
              
              <div class="form-group">
                <label for="email" class="form-label">Email Address *</label>
                <input
                  id="email"
                  type="email"
                  class="form-control"
                  formControlName="email"
                  placeholder="Enter your email"
                  [class.is-invalid]="isFieldInvalid(profileForm, 'email')"
                  [disabled]="!editing"
                />
                <div *ngIf="isFieldInvalid(profileForm, 'email')" class="invalid-feedback">
                  {{ getFieldError(profileForm, 'email') }}
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="phone" class="form-label">Phone Number</label>
                <input
                  id="phone"
                  type="tel"
                  class="form-control"
                  formControlName="phone"
                  placeholder="Enter your phone number"
                  [disabled]="!editing"
                />
              </div>
              
              <div class="form-group">
                <label for="dateOfBirth" class="form-label">Date of Birth</label>
                <input
                  id="dateOfBirth"
                  type="date"
                  class="form-control"
                  formControlName="dateOfBirth"
                  [disabled]="!editing"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="gender" class="form-label">Gender</label>
                <select
                  id="gender"
                  class="form-select"
                  formControlName="gender"
                  [disabled]="!editing"
                >
                  <option value="">Select gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                  <option value="prefer-not-to-say">Prefer not to say</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="fitnessLevel" class="form-label">Fitness Level</label>
                <select
                  id="fitnessLevel"
                  class="form-select"
                  formControlName="fitnessLevel"
                  [disabled]="!editing"
                >
                  <option value="beginner">Beginner</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="advanced">Advanced</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="height" class="form-label">Height (cm)</label>
                <input
                  id="height"
                  type="number"
                  class="form-control"
                  formControlName="height"
                  placeholder="Enter your height"
                  [disabled]="!editing"
                />
              </div>
              
              <div class="form-group">
                <label for="weight" class="form-label">Weight (kg)</label>
                <input
                  id="weight"
                  type="number"
                  class="form-control"
                  formControlName="weight"
                  placeholder="Enter your weight"
                  [disabled]="!editing"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="bio" class="form-label">Bio</label>
              <textarea
                id="bio"
                class="form-control"
                formControlName="bio"
                rows="3"
                placeholder="Tell us about yourself..."
                [disabled]="!editing"
              ></textarea>
            </div>
          </form>
        </div>

        <!-- Password Change -->
        <div class="profile-section">
          <h3 class="section-title">Change Password</h3>
          <form [formGroup]="passwordForm" class="password-form">
            <div class="form-group">
              <label for="currentPassword" class="form-label">Current Password *</label>
              <input
                id="currentPassword"
                type="password"
                class="form-control"
                formControlName="currentPassword"
                placeholder="Enter current password"
                [class.is-invalid]="isFieldInvalid(passwordForm, 'currentPassword')"
              />
              <div *ngIf="isFieldInvalid(passwordForm, 'currentPassword')" class="invalid-feedback">
                {{ getFieldError(passwordForm, 'currentPassword') }}
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="newPassword" class="form-label">New Password *</label>
                <input
                  id="newPassword"
                  type="password"
                  class="form-control"
                  formControlName="newPassword"
                  placeholder="Enter new password"
                  [class.is-invalid]="isFieldInvalid(passwordForm, 'newPassword')"
                />
                <div *ngIf="isFieldInvalid(passwordForm, 'newPassword')" class="invalid-feedback">
                  {{ getFieldError(passwordForm, 'newPassword') }}
                </div>
              </div>
              
              <div class="form-group">
                <label for="confirmPassword" class="form-label">Confirm Password *</label>
                <input
                  id="confirmPassword"
                  type="password"
                  class="form-control"
                  formControlName="confirmPassword"
                  placeholder="Confirm new password"
                  [class.is-invalid]="isFieldInvalid(passwordForm, 'confirmPassword')"
                />
                <div *ngIf="isFieldInvalid(passwordForm, 'confirmPassword')" class="invalid-feedback">
                  {{ getFieldError(passwordForm, 'confirmPassword') }}
                </div>
              </div>
            </div>

            <button 
              type="button" 
              class="btn btn-fitness"
              (click)="changePassword()"
              [disabled]="passwordForm.invalid">
              <i class="fas fa-key me-2"></i>
              Change Password
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Statistics Tab -->
    <div *ngIf="activeTab === 'stats'" class="stats-content">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-dumbbell"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ userStats.totalWorkouts }}</div>
            <div class="stat-label">Total Workouts</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-fire"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ userStats.totalCalories | number }}</div>
            <div class="stat-label">Calories Burned</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-fire"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ userStats.currentStreak }}</div>
            <div class="stat-label">Current Streak</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-trophy"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ userStats.longestStreak }}</div>
            <div class="stat-label">Longest Streak</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ userStats.averageWorkoutDuration }}min</div>
            <div class="stat-label">Avg. Duration</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-heart"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ userStats.favoriteExercise }}</div>
            <div class="stat-label">Favorite Exercise</div>
          </div>
        </div>
      </div>

      <!-- Progress Indicators -->
      <div class="progress-section">
        <h4>Goal Progress</h4>
        <div class="progress-grid">
          <div 
            *ngFor="let indicator of progressIndicators | keyvalue" 
            class="progress-card">
            <div class="progress-header">
              <div class="progress-icon">
                <i [class]="indicator.value.icon"></i>
              </div>
              <div class="progress-info">
                <h5 class="progress-label">{{ indicator.value.label }}</h5>
                <div class="progress-values">
                  {{ indicator.value.current }}/{{ indicator.value.target }}
                </div>
              </div>
            </div>
            <div class="progress-bar-container">
              <div class="progress">
                <div 
                  class="progress-bar" 
                  [ngClass]="'bg-' + getProgressColor(getProgressPercentage(indicator.value.current, indicator.value.target))"
                  [style.width.%]="getProgressPercentage(indicator.value.current, indicator.value.target)">
                </div>
              </div>
              <span class="progress-percentage">
                {{ getProgressPercentage(indicator.value.current, indicator.value.target) | number:'1.0-0' }}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Achievements Tab -->
    <div *ngIf="activeTab === 'achievements'" class="achievements-content">
      <div class="achievements-header">
        <h3>Achievements & Badges</h3>
        <div class="achievement-progress">
          <div class="progress">
            <div 
              class="progress-bar" 
              [style.width.%]="getAchievementProgress()">
            </div>
          </div>
          <span class="progress-text">{{ getAchievementProgress() | number:'1.0-0' }}% Complete</span>
        </div>
      </div>

      <!-- Achievement Categories -->
      <div class="achievement-categories">
        <div 
          *ngFor="let category of achievementCategories" 
          class="category-card"
          [class.active]="selectedCategory === category.id"
          (click)="selectedCategory = category.id">
          <div class="category-icon">
            <i [class]="category.icon"></i>
          </div>
          <div class="category-info">
            <h5 class="category-name">{{ category.name }}</h5>
            <div class="category-progress">
              <div class="progress">
                <div 
                  class="progress-bar" 
                  [style.width.%]="getCategoryProgress(category.id)">
                </div>
              </div>
              <span class="progress-text">{{ getCategoryProgress(category.id) | number:'1.0-0' }}%</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Achievements Grid -->
      <div class="achievements-section">
        <h4>Achievements</h4>
        <div class="achievements-grid">
          <div 
            *ngFor="let achievement of getAchievementsByCategory(selectedCategory || 'milestone')" 
            class="achievement-card"
            [class.earned]="achievement.earned">
            <div class="achievement-icon">
              <i [class]="achievement.icon"></i>
            </div>
            <div class="achievement-content">
              <div class="achievement-header">
                <h5 class="achievement-name">{{ achievement.name }}</h5>
                <span [class]="getRarityBadgeClass(achievement.rarity)">{{ achievement.rarity }}</span>
              </div>
              <p class="achievement-description">{{ achievement.description }}</p>
              <div *ngIf="achievement.earned" class="achievement-date">
                Earned on {{ achievement.date | date }}
              </div>
            </div>
            <div class="achievement-status">
              <i *ngIf="achievement.earned" class="fas fa-check-circle"></i>
              <i *ngIf="!achievement.earned" class="fas fa-lock"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- User Badges -->
      <div class="badges-section">
        <h4>Badges</h4>
        <div class="badges-grid">
          <div 
            *ngFor="let badge of userBadges" 
            class="badge-card"
            [class.earned]="badge.earned"
            [ngClass]="getBadgeLevelClass(badge)">
            <div class="badge-icon">
              <i [class]="badge.icon"></i>
              <div *ngIf="badge.earned" class="badge-level">
                {{ badge.level }}/{{ badge.maxLevel }}
              </div>
            </div>
            <div class="badge-content">
              <h5 class="badge-name">{{ badge.name }}</h5>
              <p class="badge-description">{{ badge.description }}</p>
              <div class="badge-progress">
                <div class="progress">
                  <div 
                    class="progress-bar" 
                    [style.width.%]="(badge.level / badge.maxLevel) * 100">
                  </div>
                </div>
                <span class="progress-text">Level {{ badge.level }}/{{ badge.maxLevel }}</span>
              </div>
            </div>
            <div class="badge-status">
              <i *ngIf="badge.earned" class="fas fa-medal"></i>
              <i *ngIf="!badge.earned" class="fas fa-lock"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div *ngIf="activeTab === 'settings'" class="settings-content">
      <div class="settings-section">
        <h3>Notifications</h3>
        <div class="settings-list">
          <div class="setting-item">
            <div class="setting-info">
              <h4>Email Notifications</h4>
              <p>Receive updates and progress reports via email</p>
            </div>
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="emailNotifications"
                [checked]="settings.emailNotifications"
                (change)="onEmailNotificationsChange($event)">
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4>Push Notifications</h4>
              <p>Get real-time notifications on your device</p>
            </div>
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="pushNotifications"
                [checked]="settings.pushNotifications"
                (change)="onPushNotificationsChange($event)">
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4>Workout Reminders</h4>
              <p>Receive reminders for scheduled workouts</p>
            </div>
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="workoutReminders"
                [checked]="settings.workoutReminders"
                (change)="onWorkoutRemindersChange($event)">
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4>Progress Reports</h4>
              <p>Weekly progress summaries and insights</p>
            </div>
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="progressReports"
                [checked]="settings.progressReports"
                (change)="onProgressReportsChange($event)">
            </div>
          </div>
        </div>
      </div>
      
      <div class="settings-section">
        <h3>Privacy</h3>
        <div class="settings-list">
          <div class="setting-item">
            <div class="setting-info">
              <h4>Privacy Mode</h4>
              <p>Hide your profile from other users</p>
            </div>
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="privacyMode"
                [checked]="settings.privacyMode"
                (change)="onPrivacyModeChange($event)">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Logout Section -->
      <div class="settings-section">
        <h3>Account</h3>
        <div class="settings-list">
          <div class="setting-item">
            <div class="setting-info">
              <h4>Logout</h4>
              <p>Sign out of your account and return to login page</p>
            </div>
            <button class="btn btn-outline-danger" (click)="logout()">
              <i class="fas fa-sign-out-alt me-2"></i>
              Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Dialog -->
  <app-confirm-dialog
    [isVisible]="showLogoutDialog"
    [data]="{
      title: 'Confirm Logout',
      message: 'Are you sure you want to logout? You will be redirected to the login page.',
      confirmText: 'Logout',
      cancelText: 'Cancel',
      type: 'warning',
      showIcon: true
    }"
    (confirm)="confirmLogout()"
    (cancel)="cancelLogout()"
    (close)="cancelLogout()">
  </app-confirm-dialog>
</div>
