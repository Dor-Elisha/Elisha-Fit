<div class="program-list page-container">
  <!-- Header -->
  <div class="component-header">
    <h2>My Workout Programs</h2>
    <p *ngIf="!loading" class="text-muted">{{ filteredPrograms.length }} of {{ programs.length }} programs</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
    </div>
    <p class="loading-text">Loading programs...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && programs.length === 0" class="empty-state">
    <i class="fas fa-dumbbell empty-icon"></i>
    <h3 class="empty-title">No Programs Yet</h3>
    <p class="empty-description">Create your first workout program to get started!</p>
  </div>

  <!-- No Results State -->
  <div *ngIf="!loading && programs.length > 0 && filteredPrograms.length === 0" class="empty-state">
    <i class="fas fa-search empty-icon"></i>
    <h3 class="empty-title">No Programs Found</h3>
    <p class="empty-description">Try adjusting your search or filters.</p>
    <button class="btn btn-secondary" (click)="clearFilters()">Clear Filters</button>
  </div>

  <!-- Filters and Search -->
  <div *ngIf="!loading && programs.length > 0" class="filters-section section-container">
    <div class="search-bar">
      <div class="search-input">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="onSearchChange()"
          placeholder="Search programs..."
          class="form-control"
        />
      </div>
    </div>

    <div class="filter-controls">
      <div class="form-row">
        <div class="form-group">
          <label for="difficulty-filter">Difficulty:</label>
          <select 
            id="difficulty-filter" 
            [(ngModel)]="selectedDifficulty" 
            (change)="onDifficultyChange()"
            class="form-control"
          >
            <option *ngFor="let diff of difficulties" [value]="diff.value">
              {{ diff.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="sort-by">Sort by:</label>
          <select 
            id="sort-by" 
            [(ngModel)]="sortBy" 
            (change)="onSortChange()"
            class="form-control"
          >
            <option *ngFor="let option of sortOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="d-block">Sort Order:</label>
          <button 
            class="btn btn-outline-secondary btn-icon" 
            (click)="toggleSortOrder()"
            [title]="sortOrder === 'asc' ? 'Sort Descending' : 'Sort Ascending'"
          >
            <i class="fas" [class.fa-sort-amount-down]="sortOrder === 'desc'" [class.fa-sort-amount-up]="sortOrder === 'asc'"></i>
            {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}
          </button>
        </div>
      </div>

      <div class="btn-group-actions">
        <div class="clear-filters" *ngIf="hasActiveFilters()">
          <button class="btn btn-outline-danger btn-icon" (click)="clearFilters()">
            <i class="fas fa-times"></i> Clear Filters ({{ getActiveFilterCount() }})
          </button>
        </div>

        <div class="advanced-filters-toggle">
          <button 
            class="btn btn-outline-primary btn-icon" 
            (click)="toggleAdvancedFilters()"
            [class.active]="showAdvancedFilters"
          >
            <i class="fas fa-filter"></i> 
            {{ showAdvancedFilters ? 'Hide' : 'Show' }} Advanced Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Advanced Filters -->
    <div *ngIf="showAdvancedFilters" class="advanced-filters">
      <div class="advanced-filters-grid">
        <!-- Duration Filter -->
        <div class="filter-section">
          <h4 class="form-section-title">Duration</h4>
          <div class="filter-options">
            <label *ngFor="let option of durationOptions" class="filter-option">
              <input 
                type="radio" 
                name="duration" 
                [value]="option.value"
                [(ngModel)]="selectedDuration"
                (change)="onDurationChange()"
              />
              <span>{{ option.label }}</span>
            </label>
          </div>
        </div>

        <!-- Muscle Groups Filter -->
        <div class="filter-section" *ngIf="availableMuscleGroups.length > 0">
          <h4 class="form-section-title">Target Muscle Groups</h4>
          <div class="filter-options">
            <label *ngFor="let muscle of availableMuscleGroups" class="filter-option">
              <input 
                type="checkbox" 
                [value]="muscle"
                [checked]="selectedMuscleGroups.includes(muscle)"
                #mgInput
                (change)="onMuscleGroupChange(muscle, mgInput.checked)"
              />
              <span>{{ muscle }}</span>
            </label>
          </div>
        </div>

        <!-- Tags Filter -->
        <div class="filter-section" *ngIf="availableTags.length > 0">
          <h4 class="form-section-title">Tags</h4>
          <div class="filter-options">
            <label *ngFor="let tag of availableTags" class="filter-option">
              <input 
                type="checkbox" 
                [value]="tag"
                [checked]="selectedTags.includes(tag)"
                #tagInput
                (change)="onTagChange(tag, tagInput.checked)"
              />
              <span>{{ tag }}</span>
            </label>
          </div>
        </div>

        <!-- Equipment Filter -->
        <div class="filter-section" *ngIf="availableEquipment.length > 0">
          <h4 class="form-section-title">Equipment</h4>
          <div class="filter-options">
            <label *ngFor="let equipment of availableEquipment" class="filter-option">
              <input 
                type="checkbox" 
                [value]="equipment"
                [checked]="selectedEquipment.includes(equipment)"
                #eqInput
                (change)="onEquipmentChange(equipment, eqInput.checked)"
              />
              <span>{{ equipment }}</span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Programs Grid -->
  <div *ngIf="!loading && filteredPrograms.length > 0" class="card-grid">
    <div *ngFor="let program of filteredPrograms" class="card-item">
      <div class="card-header">
        <div class="program-icon">
          <i [class]="getCategoryIcon(program)"></i>
        </div>
        <div class="program-info">
          <h3 class="card-title">{{ program.name }}</h3>
          <p class="text-muted" *ngIf="program.description">
            {{ program.description }}
          </p>
        </div>
        <div class="card-actions" *ngIf="showActions">
          <div class="dropdown">
            <button class="btn btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" (click)="onViewProgram(program)">
                <i class="fas fa-eye"></i> View Details
              </a></li>
              <li><a class="dropdown-item" (click)="onEditProgram(program)">
                <i class="fas fa-edit"></i> Edit Program
              </a></li>
              <li><a class="dropdown-item" (click)="onDuplicateProgram(program)">
                <i class="fas fa-copy"></i> Duplicate
              </a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" (click)="onDeleteProgram(program)">
                <i class="fas fa-trash"></i> Delete
              </a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="card-content">
        <div class="program-meta">
          <div class="meta-item">
            <i class="fas fa-signal"></i>
            <span>{{ program.difficulty | titlecase }}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-clock"></i>
            <span>{{ program.metadata.estimatedDuration }} min</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-dumbbell"></i>
            <span>{{ program.exercises?.length || 0 }} exercises</span>
          </div>
        </div>

        <div class="program-tags" *ngIf="program.metadata.tags && program.metadata.tags.length > 0">
          <span *ngFor="let tag of program.metadata.tags" class="badge badge-primary">{{ tag }}</span>
        </div>
      </div>

      <div class="card-footer">
        <div class="program-stats">
          <small class="text-muted">Created: {{ program.createdAt | date:'shortDate' }}</small>
        </div>
        <div class="program-actions">
          <button class="btn btn-sm btn-primary btn-icon" (click)="onViewProgram(program)">
            <i class="fas fa-eye"></i> View
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Dialog -->
<app-confirm-dialog
  [isVisible]="showDeleteDialog"
  [data]="deleteDialogData"
  (confirm)="onConfirmDelete()"
  (cancel)="onCancelDelete()"
></app-confirm-dialog>

<!-- Duplicate Program Dialog -->
<app-duplicate-program-dialog
  [isVisible]="showDuplicateDialog"
  [data]="duplicateDialogData"
  (confirm)="onConfirmDuplicate($event)"
  (cancel)="onCancelDuplicate()"
></app-duplicate-program-dialog>

