<div class="program-wizard page-container">
  <!-- Breadcrumb Navigation -->
  <app-breadcrumb 
    [items]="wizardBreadcrumbs"
    [showHome]="true">
  </app-breadcrumb>
  
  <div class="component-header">
    <h2>Create Custom Workout Program</h2>
  </div>

  <div class="wizard-content">
    <!-- Step Loading State -->
    <app-loading 
      *ngIf="stepLoading"
      type="dots"
      size="md"
      text="Loading step..."
      [overlay]="true">
    </app-loading>
    
    <!-- Step 1: Program Details -->
    <div *ngIf="currentStep === 1" class="step-content section-container">
      <h3>Program Details</h3>
      <form [formGroup]="programForm" class="program-form">
        <div class="form-group">
          <label for="name">Program Name<span class="required">*</span></label>
          <input 
            id="name" 
            type="text" 
            formControlName="name" 
            placeholder="Enter program name"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('name')"
            [class.is-valid]="programForm.get('name')?.valid && programForm.get('name')?.touched"
          />
          <div class="error-message" *ngIf="isFieldInvalid('name')">
            {{ getFieldError('name') }}
          </div>
          <div class="valid-feedback" *ngIf="programForm.get('name')?.valid && programForm.get('name')?.touched">
            <i class="fas fa-check"></i> Program name looks good!
          </div>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea 
            id="description" 
            formControlName="description" 
            placeholder="Describe your program..."
            class="form-control"
            rows="3"
          ></textarea>
          <div class="error-message" *ngIf="programForm.get('description')?.touched && programForm.get('description')?.invalid">
            <span *ngIf="programForm.get('description')?.errors?.['maxlength']">Description must be at most 500 characters.</span>
          </div>
        </div>

        <div class="form-group">
          <label for="difficulty">Difficulty Level<span class="required">*</span></label>
          <select id="difficulty" formControlName="difficulty" class="form-control">
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
          <div class="error-message" *ngIf="programForm.get('difficulty')?.touched && programForm.get('difficulty')?.invalid">
            <span *ngIf="programForm.get('difficulty')?.errors?.['required']">Difficulty level is required.</span>
          </div>
        </div>



        <div class="form-group">
          <label for="targetMuscleGroups">Target Muscle Groups<span class="required">*</span></label>
          <div class="muscle-groups-selector">
            <div class="muscle-group-options">
              <label class="muscle-group-option" *ngFor="let muscle of ['Chest', 'Back', 'Shoulders', 'Arms', 'Legs', 'Core', 'Full Body']">
                <input 
                  type="checkbox" 
                  [value]="muscle"
                  (change)="toggleMuscleGroup(muscle, $event)"
                  [checked]="isMuscleGroupSelected(muscle)"
                />
                <span class="muscle-group-label">{{ muscle }}</span>
              </label>
            </div>
          </div>
          <div class="error-message" *ngIf="isFieldInvalid('targetMuscleGroups')">
            {{ getFieldError('targetMuscleGroups') }}
          </div>
        </div>



        <div class="form-group">
          <label for="tags">Tags (Optional)</label>
          <input 
            id="tags" 
            type="text" 
            formControlName="tags" 
            placeholder="Enter tags separated by commas (e.g., strength, beginner, home)"
            class="form-control"
          />
          <small class="form-text">Add tags to help categorize your program</small>
        </div>
      </form>
    </div>

    <!-- Step 2: Exercise Selection -->
    <div *ngIf="currentStep === 2" class="step-content section-container">
      <h3>Select Exercises</h3>
      <app-exercise-selector 
        [config]="{ multiple: true, maxSelections: 20 }"
        [selectedExercises]="selectedExercises"
        (exercisesSelected)="onExercisesSelected($event)"
        (exerciseRemoved)="onExerciseRemoved($event)"
      ></app-exercise-selector>
    </div>

    <!-- Step 3: Exercise Configuration -->
    <div *ngIf="currentStep === 3" class="step-content section-container">
      <h3>Configure Exercises</h3>
      <app-exercise-config 
        [selectedExercises]="selectedExercises"
        (configuredExercisesChange)="onExercisesConfigured($event)"
        (validationStateChange)="onStep3ValidationChange($event)"
      ></app-exercise-config>
    </div>

    <!-- Step 4: Review & Create -->
    <div *ngIf="currentStep === 4" class="step-content section-container">
      <h3>Review Your Program</h3>
      <div class="program-summary">
        <div class="summary-section">
          <h4>Program Details</h4>
          <div class="summary-grid">
            <div class="summary-item">
              <label>Name:</label>
              <span>{{ getProgramSummary().name }}</span>
            </div>
            <div class="summary-item">
              <label>Category:</label>
              <span>{{ getProgramSummary().category }}</span>
            </div>
            <div class="summary-item">
              <label>Difficulty:</label>
              <span>{{ getProgramSummary().difficulty }}</span>
            </div>
            <div class="summary-item">
              <label>Duration:</label>
              <span>{{ getProgramSummary().estimatedDuration }} minutes</span>
            </div>
            <div class="summary-item">
              <label>Target Muscles:</label>
              <span>{{ getProgramSummary().targetMuscleGroups?.join(', ') }}</span>
            </div>
            <div class="summary-item">
              <label>Equipment:</label>
              <span>{{ getProgramSummary().equipment?.length ? getProgramSummary().equipment.join(', ') : 'None specified' }}</span>
            </div>
          </div>
          <div class="summary-item full-width" *ngIf="getProgramSummary().description">
            <label>Description:</label>
            <p>{{ getProgramSummary().description }}</p>
          </div>
        </div>

        <div class="summary-section">
          <h4>Exercise Summary</h4>
          <div class="exercise-summary">
            <div class="summary-stats">
              <div class="stat-item">
                <i class="fas fa-dumbbell"></i>
                <span>{{ getProgramSummary().exerciseCount }} Exercises</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-layer-group"></i>
                <span>{{ getProgramSummary().totalSets }} Total Sets</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span>{{ getProgramSummary().totalDuration }} min Rest Time</span>
              </div>
            </div>
            <div class="exercise-list">
              <div *ngFor="let exercise of configuredExercises" class="exercise-item">
                <div class="exercise-info">
                  <h5>{{ exercise.name }}</h5>
                  <p>{{ exercise.sets }} sets Ã— {{ exercise.reps }} reps</p>
                </div>
                <div class="exercise-rest">
                  <i class="fas fa-pause"></i>
                  {{ exercise.restTime }}s rest
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="summary-section">
          <h4>Ready to Create?</h4>
          <div class="creation-confirmation">
            <p>Review your program details above. Once you click "Create Program", your custom workout program will be saved and ready to use.</p>
            <div class="confirmation-checklist">
              <div class="checklist-item" [class.completed]="getProgramSummary().name">
                <i class="fas fa-check"></i>
                <span>Program name is set</span>
              </div>
              <div class="checklist-item" [class.completed]="getProgramSummary().exerciseCount > 0">
                <i class="fas fa-check"></i>
                <span>Exercises are configured</span>
              </div>
              <div class="checklist-item" [class.completed]="getProgramSummary().targetMuscleGroups?.length > 0">
                <i class="fas fa-check"></i>
                <span>Target muscles are selected</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="btn-group-actions">
    <button 
      type="button" 
      class="btn btn-secondary btn-icon" 
      (click)="previousStep()"
      [disabled]="currentStep === 1"
    >
      <i class="fas fa-arrow-left"></i> Previous
    </button>

    <div class="step-info">
      Step {{ currentStep }} of {{ totalSteps }}
    </div>

    <button 
      *ngIf="currentStep < totalSteps"
      type="button" 
      class="btn btn-primary btn-icon" 
      (click)="nextStep()"
      [disabled]="!canProceedToNextStep()"
    >
      Next <i class="fas fa-arrow-right"></i>
    </button>

    <button 
      *ngIf="currentStep < totalSteps"
      type="button" 
      class="btn btn-primary btn-icon" 
      (click)="nextStep()"
      [disabled]="!canProceedToNextStep()"
    >
      Next <i class="fas fa-arrow-right"></i>
    </button>

    <button 
      *ngIf="currentStep === totalSteps"
      type="button" 
      class="btn btn-success btn-icon" 
      (click)="createProgram()"
      [disabled]="!canProceedToNextStep() || creatingProgram"
    >
      <app-loading 
        *ngIf="creatingProgram"
        type="spinner"
        size="sm"
        [text]="''"
        [visible]="creatingProgram">
      </app-loading>
      <i *ngIf="!creatingProgram" class="fas fa-check"></i> 
      {{ creatingProgram ? 'Creating...' : 'Create Program' }}
    </button>
  </div>

  <!-- Validation Summary -->
  <div *ngIf="!canProceedToNextStep()" class="validation-summary">
    <div class="alert alert-warning">
      <i class="fas fa-exclamation-triangle"></i>
      <span *ngIf="currentStep === 1">Please complete all required fields to continue.</span>
      <span *ngIf="currentStep === 2">Please select at least one exercise to continue.</span>
      <span *ngIf="currentStep === 3">Please fix validation errors to create the program.</span>
    </div>
  </div>
</div>
