<div class="progress-analytics">
  <!-- Header -->
  <div class="analytics-header">
    <h2>Progress Analytics</h2>
    <div class="time-range-selector">
      <label for="time-range">Time Range:</label>
      <select 
        id="time-range" 
        [(ngModel)]="selectedTimeRange" 
        (change)="onTimeRangeChange()"
        class="form-control"
      >
        <option *ngFor="let option of timeRangeOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading analytics...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && (!progressEntries || progressEntries.length === 0)" class="empty-state">
    <i class="fas fa-chart-line"></i>
    <h3>No Analytics Data</h3>
    <p>Complete some workouts to see your progress analytics here!</p>
  </div>

  <!-- Analytics Content -->
  <div *ngIf="!loading && progressEntries.length > 0 && analyticsSummary" class="analytics-content">
    <!-- Summary Cards -->
    <div class="summary-section">
      <h3>Summary</h3>
      <div class="summary-grid">
        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-dumbbell"></i>
          </div>
          <div class="card-content">
            <h4>{{ analyticsSummary.totalWorkouts }}</h4>
            <p>Total Workouts</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="card-content">
            <h4>{{ getFormattedDuration(analyticsSummary.totalDuration) }}</h4>
            <p>Total Duration</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-star"></i>
          </div>
          <div class="card-content">
            <h4>{{ analyticsSummary.averageRating }}/5</h4>
            <p>Average Rating</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="card-content">
            <h4>{{ analyticsSummary.completionRate }}%</h4>
            <p>Completion Rate</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-weight-hanging"></i>
          </div>
          <div class="card-content">
            <h4>{{ analyticsSummary.averageWeight }} kg</h4>
            <p>Average Weight</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-redo"></i>
          </div>
          <div class="card-content">
            <h4>{{ analyticsSummary.averageReps }}</h4>
            <p>Average Reps</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i class="fas fa-trophy"></i>
          </div>
          <div class="card-content">
            <h4>{{ analyticsSummary.mostUsedProgram }}</h4>
            <p>Most Used Program</p>
          </div>
        </div>

        <div class="summary-card">
          <div class="card-icon">
            <i [class]="getTrendIcon(analyticsSummary.recentTrend)"></i>
          </div>
          <div class="card-content">
            <h4>{{ getTrendText(analyticsSummary.recentTrend) }}</h4>
            <p>Recent Trend</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <h3>Progress Charts</h3>
      
      <!-- Weight Progress Chart -->
      <div class="chart-container" *ngIf="weightProgressChart">
        <div class="chart-header">
          <h4>Weight Progress</h4>
          <p>Track your average weight progression over time</p>
        </div>
        <div class="chart-wrapper">
          <canvas #weightChart></canvas>
        </div>
      </div>

      <!-- Reps Progress Chart -->
      <div class="chart-container" *ngIf="repsProgressChart">
        <div class="chart-header">
          <h4>Reps Progress</h4>
          <p>Monitor your average reps performance</p>
        </div>
        <div class="chart-wrapper">
          <canvas #repsChart></canvas>
        </div>
      </div>

      <!-- Duration Chart -->
      <div class="chart-container" *ngIf="durationChart">
        <div class="chart-header">
          <h4>Workout Duration</h4>
          <p>Track your workout duration trends</p>
        </div>
        <div class="chart-wrapper">
          <canvas #durationChart></canvas>
        </div>
      </div>

      <!-- Rating Distribution Chart -->
      <div class="chart-container" *ngIf="ratingChart">
        <div class="chart-header">
          <h4>Workout Ratings</h4>
          <p>Distribution of your workout ratings</p>
        </div>
        <div class="chart-wrapper">
          <canvas #ratingChart></canvas>
        </div>
      </div>

      <!-- Program Usage Chart -->
      <div class="chart-container" *ngIf="programUsageChart">
        <div class="chart-header">
          <h4>Program Usage</h4>
          <p>Which programs you use most frequently</p>
        </div>
        <div class="chart-wrapper">
          <canvas #programUsageChart></canvas>
        </div>
      </div>

      <!-- Completion Rate Chart -->
      <div class="chart-container" *ngIf="completionRateChart">
        <div class="chart-header">
          <h4>Completion Rate</h4>
          <p>Track your workout completion consistency</p>
        </div>
        <div class="chart-wrapper">
          <canvas #completionRateChart></canvas>
        </div>
      </div>
    </div>

    <!-- Highlights Section -->
    <div class="highlights-section" *ngIf="analyticsSummary.bestRatedWorkout || analyticsSummary.longestWorkout">
      <h3>Highlights</h3>
      <div class="highlights-grid">
        <div class="highlight-card" *ngIf="analyticsSummary.bestRatedWorkout">
          <div class="highlight-icon">
            <i class="fas fa-star"></i>
          </div>
          <div class="highlight-content">
            <h4>Best Rated Workout</h4>
            <p class="highlight-program">
              {{ getProgramName(analyticsSummary.bestRatedWorkout.programId) }}
            </p>
            <p class="highlight-rating">
              {{ analyticsSummary.bestRatedWorkout.rating }}/5 stars
            </p>
            <p class="highlight-date">
              {{ getFormattedDate(analyticsSummary.bestRatedWorkout.workoutDate) }}
            </p>
          </div>
        </div>

        <div class="highlight-card" *ngIf="analyticsSummary.longestWorkout">
          <div class="highlight-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="highlight-content">
            <h4>Longest Workout</h4>
            <p class="highlight-program">
              {{ getProgramName(analyticsSummary.longestWorkout.programId) }}
            </p>
            <p class="highlight-duration">
              {{ getFormattedDuration(analyticsSummary.longestWorkout.totalDuration) }}
            </p>
            <p class="highlight-date">
              {{ getFormattedDate(analyticsSummary.longestWorkout.workoutDate) }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Insights Section -->
    <div class="insights-section">
      <h3>Insights</h3>
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-icon">
            <i class="fas fa-lightbulb"></i>
          </div>
          <div class="insight-content">
            <h4>Performance Trend</h4>
            <p>
              Your performance is currently 
              <span [class]="'trend-' + analyticsSummary.recentTrend">
                {{ getTrendText(analyticsSummary.recentTrend).toLowerCase() }}
              </span>.
              <span *ngIf="analyticsSummary.recentTrend === 'improving'">
                Keep up the great work!
              </span>
              <span *ngIf="analyticsSummary.recentTrend === 'declining'">
                Consider adjusting your routine or taking a rest day.
              </span>
              <span *ngIf="analyticsSummary.recentTrend === 'stable'">
                Consistency is key - you're maintaining good form.
              </span>
            </p>
          </div>
        </div>

        <div class="insight-card">
          <div class="insight-icon">
            <i class="fas fa-chart-pie"></i>
          </div>
          <div class="insight-content">
            <h4>Completion Analysis</h4>
            <p>
              You're completing {{ analyticsSummary.completionRate }}% of your sets.
              <span *ngIf="analyticsSummary.completionRate >= 90">
                Excellent consistency!
              </span>
              <span *ngIf="analyticsSummary.completionRate >= 70 && analyticsSummary.completionRate < 90">
                Good progress, room for improvement.
              </span>
              <span *ngIf="analyticsSummary.completionRate < 70">
                Consider adjusting your workout intensity.
              </span>
            </p>
          </div>
        </div>

        <div class="insight-card">
          <div class="insight-icon">
            <i class="fas fa-dumbbell"></i>
          </div>
          <div class="insight-content">
            <h4>Program Preference</h4>
            <p>
              Your most used program is "{{ analyticsSummary.mostUsedProgram }}".
              <span *ngIf="analyticsSummary.totalWorkouts > 5">
                You've completed {{ analyticsSummary.totalWorkouts }} workouts with an average duration of 
                {{ getFormattedDuration(getMath().round(analyticsSummary.totalDuration / analyticsSummary.totalWorkouts)) }}.
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
