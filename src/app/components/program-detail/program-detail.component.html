<div class="program-detail">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading program details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && !program" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>Program Not Found</h3>
    <p>The requested program could not be found or has been deleted.</p>
    <button class="btn btn-primary" (click)="onBackToList()">
      <i class="fas fa-arrow-left"></i> Back to Programs
    </button>
  </div>

  <!-- Program Content -->
  <div *ngIf="!loading && program" class="program-content">
    <!-- Header -->
    <div class="program-header">
      <div class="header-left">
        <button class="btn btn-outline-secondary back-btn" (click)="onBackToList()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <div class="program-title">
          <div class="program-icon">
            <i [class]="getCategoryIcon(program)"></i>
          </div>
          <div class="title-content">
            <h1>{{ program.name }}</h1>
            <p *ngIf="program.description" class="description">{{ program.description }}</p>
            <div class="program-meta">
              <span class="meta-item">
                <i class="fas fa-calendar"></i>
                Created {{ program.createdAt | date:'mediumDate' }}
              </span>
              <span class="meta-item" *ngIf="program.updatedAt && program.updatedAt !== program.createdAt">
                <i class="fas fa-edit"></i>
                Updated {{ program.updatedAt | date:'mediumDate' }}
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="header-right" *ngIf="showActions">
        <div class="action-buttons">
          <button 
            *ngIf="canStartWorkout()"
            class="btn btn-primary start-workout-btn" 
            (click)="onStartWorkout()"
          >
            <i class="fas fa-play"></i> Start Workout
          </button>
          
          <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <ul class="dropdown-menu">
              <li *ngIf="canEdit()">
                <a class="dropdown-item" (click)="onEditProgram()">
                  <i class="fas fa-edit"></i> Edit Program
                </a>
              </li>
              <li *ngIf="canDuplicate()">
                <a class="dropdown-item" (click)="onDuplicateProgram()">
                  <i class="fas fa-copy"></i> Duplicate
                </a>
              </li>
              <li>
                <a class="dropdown-item" (click)="onExportProgram()">
                  <i class="fas fa-download"></i> Export
                </a>
              </li>
              <li *ngIf="canDelete()">
                <hr class="dropdown-divider">
                <a class="dropdown-item text-danger" (click)="onDeleteProgram()">
                  <i class="fas fa-trash"></i> Delete
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
      <div class="stat-card">
        <i class="fas fa-dumbbell"></i>
        <div class="stat-content">
          <span class="stat-value">{{ getProgramStats()?.totalExercises }}</span>
          <span class="stat-label">Exercises</span>
        </div>
      </div>
      
      <div class="stat-card">
        <i class="fas fa-clock"></i>
        <div class="stat-content">
          <span class="stat-value">{{ getProgramStats()?.totalDuration }}</span>
          <span class="stat-label">Duration</span>
        </div>
      </div>
      
      <div class="stat-card">
        <i class="fas fa-signal"></i>
        <div class="stat-content">
          <span class="stat-value">{{ getProgramStats()?.difficulty }}</span>
          <span class="stat-label">Difficulty</span>
        </div>
      </div>
      
      <div class="stat-card">
        <i class="fas fa-layer-group"></i>
        <div class="stat-content">
          <span class="stat-value">{{ getProgramStats()?.category }}</span>
          <span class="stat-label">Category</span>
        </div>
      </div>

      <div class="stat-card">
        <i class="fas fa-weight-hanging"></i>
        <div class="stat-content">
          <span class="stat-value">{{ getProgramStats()?.totalVolume }}kg</span>
          <span class="stat-label">Total Volume</span>
        </div>
      </div>

      <div class="stat-card">
        <i class="fas fa-repeat"></i>
        <div class="stat-content">
          <span class="stat-value">{{ getProgramStats()?.totalSets }}</span>
          <span class="stat-label">Total Sets</span>
        </div>
      </div>
    </div>

    <!-- Progress Overview -->
    <div class="progress-overview" *ngIf="getWorkoutHistory().length > 0">
      <div class="progress-header">
        <h3><i class="fas fa-chart-line"></i> Recent Progress</h3>
        <button class="btn btn-sm btn-outline-primary" (click)="selectTab('history')">
          View All History
        </button>
      </div>
      <div class="progress-cards">
        <div class="progress-card">
          <div class="progress-icon">
            <i class="fas fa-fire"></i>
          </div>
          <div class="progress-content">
            <span class="progress-value">{{ getLastWorkoutStats()?.completionRate }}%</span>
            <span class="progress-label">Last Completion</span>
          </div>
        </div>
        <div class="progress-card">
          <div class="progress-icon">
            <i class="fas fa-trophy"></i>
          </div>
          <div class="progress-content">
            <span class="progress-value">{{ getWorkoutHistory().length }}</span>
            <span class="progress-label">Times Completed</span>
          </div>
        </div>
        <div class="progress-card">
          <div class="progress-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="progress-content">
            <span class="progress-value">{{ getLastWorkoutDate() }}</span>
            <span class="progress-label">Last Workout</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <nav class="tabs-nav">
        <button 
          class="tab-btn" 
          [class.active]="selectedTab === 'overview'"
          (click)="selectTab('overview')"
        >
          <i class="fas fa-info-circle"></i> Overview
        </button>
        <button 
          class="tab-btn" 
          [class.active]="selectedTab === 'exercises'"
          (click)="selectTab('exercises')"
        >
          <i class="fas fa-list"></i> Exercises
        </button>
        <button 
          class="tab-btn" 
          [class.active]="selectedTab === 'stats'"
          (click)="selectTab('stats')"
        >
          <i class="fas fa-chart-bar"></i> Statistics
        </button>
        <button 
          class="tab-btn" 
          [class.active]="selectedTab === 'history'"
          (click)="selectTab('history')"
        >
          <i class="fas fa-history"></i> History
        </button>
      </nav>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Overview Tab -->
        <div *ngIf="selectedTab === 'overview'" class="tab-pane">
          <div class="overview-grid">
            <div class="overview-section">
              <h3>Program Information</h3>
              <div class="info-grid">
                <div class="info-item">
                  <span class="label">Difficulty:</span>
                  <span class="difficulty-badge" [style.background-color]="getDifficultyColor(program.difficulty)">
                    {{ program.difficulty }}
                  </span>
                </div>
                <div class="info-item">
                  <span class="label">Category:</span>
                  <span class="value">{{ getProgramStats()?.category }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Created:</span>
                  <span class="value">{{ program.createdAt | date:'mediumDate' }}</span>
                </div>
                <div class="info-item" *ngIf="program.updatedAt && program.updatedAt !== program.createdAt">
                  <span class="label">Updated:</span>
                  <span class="value">{{ program.updatedAt | date:'mediumDate' }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Estimated Duration:</span>
                  <span class="value">{{ getProgramStats()?.totalDuration }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Total Volume:</span>
                  <span class="value">{{ getProgramStats()?.totalVolume }}kg</span>
                </div>
              </div>
            </div>

            <div class="overview-section" *ngIf="getProgramStats()?.muscleGroups?.length">
              <h3>Target Muscle Groups</h3>
              <div class="muscle-groups">
                <span 
                  *ngFor="let muscle of getProgramStats()?.muscleGroups" 
                  class="muscle-group"
                  [style.background-color]="getMuscleGroupColor(muscle)"
                >
                  {{ muscle }}
                </span>
              </div>
              <div class="muscle-distribution" *ngIf="getMuscleGroupDistribution().length > 0">
                <h4>Muscle Group Distribution</h4>
                <div class="distribution-bars">
                  <div 
                    *ngFor="let group of getMuscleGroupDistribution()" 
                    class="distribution-bar"
                  >
                    <div class="bar-label">{{ group.muscle }}</div>
                    <div class="bar-container">
                      <div class="bar-fill" [style.width.%]="group.percentage"></div>
                    </div>
                    <div class="bar-value">{{ group.count }} exercises</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="overview-section" *ngIf="getProgramStats()?.equipment?.length">
              <h3>Equipment Needed</h3>
              <div class="equipment-list">
                <div 
                  *ngFor="let item of getProgramStats()?.equipment" 
                  class="equipment-item"
                >
                  <i [class]="getEquipmentIcon(item)"></i>
                  <span>{{ item }}</span>
                </div>
              </div>
            </div>

            <div class="overview-section" *ngIf="getProgramStats()?.tags?.length">
              <h3>Tags</h3>
              <div class="tags">
                <span *ngFor="let tag of getProgramStats()?.tags" class="tag">
                  {{ tag }}
                </span>
              </div>
            </div>

            <div class="overview-section">
              <h3>Workout Structure</h3>
              <div class="workout-structure">
                <div class="structure-item">
                  <i class="fas fa-list-ol"></i>
                  <div class="structure-content">
                    <span class="structure-value">{{ getProgramStats()?.totalExercises }}</span>
                    <span class="structure-label">Exercises</span>
                  </div>
                </div>
                <div class="structure-item">
                  <i class="fas fa-layer-group"></i>
                  <div class="structure-content">
                    <span class="structure-value">{{ getProgramStats()?.totalSets }}</span>
                    <span class="structure-label">Total Sets</span>
                  </div>
                </div>
                <div class="structure-item">
                  <i class="fas fa-repeat"></i>
                  <div class="structure-content">
                    <span class="structure-value">{{ getProgramStats()?.totalReps }}</span>
                    <span class="structure-label">Total Reps</span>
                  </div>
                </div>
                <div class="structure-item">
                  <i class="fas fa-pause"></i>
                  <div class="structure-content">
                    <span class="structure-value">{{ getProgramStats()?.averageRestTime }}</span>
                    <span class="structure-label">Avg Rest Time</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Exercises Tab -->
        <div *ngIf="selectedTab === 'exercises'" class="tab-pane">
          <div class="exercises-header">
            <div class="exercises-info">
              <h3>Exercise Breakdown</h3>
              <p>{{ program.exercises.length }} exercises • {{ getProgramStats()?.totalSets }} total sets</p>
            </div>
            <div class="exercises-actions">
              <button class="btn btn-sm btn-outline-secondary" (click)="expandAllExercises()">
                <i class="fas fa-expand-arrows-alt"></i> Expand All
              </button>
              <button class="btn btn-sm btn-outline-secondary" (click)="collapseAllExercises()">
                <i class="fas fa-compress-arrows-alt"></i> Collapse All
              </button>
            </div>
          </div>

          <div class="exercises-container">
            <div *ngFor="let exercise of program.exercises; let i = index" class="exercise-card">
              <div class="exercise-header" (click)="toggleExerciseExpansion(exercise.id)">
                <div class="exercise-order">{{ exercise.order }}</div>
                <div class="exercise-info">
                  <h4>{{ exercise.name }}</h4>
                  <div class="exercise-summary">
                    <span class="summary-item">
                      <i class="fas fa-layer-group"></i>
                      {{ exercise.sets }} sets
                    </span>
                    <span class="summary-item">
                      <i class="fas fa-repeat"></i>
                      {{ exercise.reps }} reps
                    </span>
                    <span class="summary-item" *ngIf="exercise.weight > 0">
                      <i class="fas fa-weight-hanging"></i>
                      {{ exercise.weight }}kg
                    </span>
                    <span class="summary-item">
                      <i class="fas fa-pause"></i>
                      {{ formatRestTime(exercise.restTime) }}
                    </span>
                  </div>
                </div>
                <div class="exercise-toggle">
                  <i class="fas" [class.fa-chevron-down]="isExerciseExpanded(exercise.id)" [class.fa-chevron-right]="!isExerciseExpanded(exercise.id)"></i>
                </div>
              </div>
              
              <div *ngIf="isExerciseExpanded(exercise.id)" class="exercise-details">
                <div class="exercise-stats">
                  <div class="stat">
                    <span class="label">Sets:</span>
                    <span class="value">{{ exercise.sets }}</span>
                  </div>
                  <div class="stat">
                    <span class="label">Reps:</span>
                    <span class="value">{{ exercise.reps }}</span>
                  </div>
                  <div class="stat">
                    <span class="label">Weight:</span>
                    <span class="value">{{ exercise.weight }}kg</span>
                  </div>
                  <div class="stat">
                    <span class="label">Rest Time:</span>
                    <span class="value">{{ formatRestTime(exercise.restTime) }}</span>
                  </div>
                  <div class="stat">
                    <span class="label">Volume:</span>
                    <span class="value">{{ exercise.sets * exercise.reps * exercise.weight }}kg</span>
                  </div>
                  <div class="stat">
                    <span class="label">Total Reps:</span>
                    <span class="value">{{ exercise.sets * exercise.reps }}</span>
                  </div>
                </div>
                
                <div *ngIf="exercise.notes" class="exercise-notes">
                  <span class="label">Notes:</span>
                  <p>{{ exercise.notes }}</p>
                </div>

                <div class="exercise-progress" *ngIf="getExerciseProgress(exercise.id)">
                  <span class="label">Recent Performance:</span>
                  <div class="progress-stats">
                    <div class="progress-stat">
                      <span class="progress-label">Best Weight:</span>
                      <span class="progress-value">{{ getExerciseProgress(exercise.id)?.bestWeight }}kg</span>
                    </div>
                    <div class="progress-stat">
                      <span class="progress-label">Last Weight:</span>
                      <span class="progress-value">{{ getExerciseProgress(exercise.id)?.lastWeight }}kg</span>
                    </div>
                    <div class="progress-stat">
                      <span class="progress-label">Times Done:</span>
                      <span class="progress-value">{{ getExerciseProgress(exercise.id)?.timesDone }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Statistics Tab -->
        <div *ngIf="selectedTab === 'stats'" class="tab-pane">
          <div class="stats-grid">
            <div class="stat-section">
              <h3>Workout Summary</h3>
              <div class="stats-cards">
                <div class="stat-card">
                  <i class="fas fa-dumbbell"></i>
                  <div class="stat-content">
                    <span class="stat-value">{{ getProgramStats()?.totalExercises }}</span>
                    <span class="stat-label">Total Exercises</span>
                  </div>
                </div>
                
                <div class="stat-card">
                  <i class="fas fa-clock"></i>
                  <div class="stat-content">
                    <span class="stat-value">{{ getProgramStats()?.totalDuration }}</span>
                    <span class="stat-label">Total Duration</span>
                  </div>
                </div>
                
                <div class="stat-card">
                  <i class="fas fa-layer-group"></i>
                  <div class="stat-content">
                    <span class="stat-value">{{ getProgramStats()?.totalSets }}</span>
                    <span class="stat-label">Total Sets</span>
                  </div>
                </div>
                
                <div class="stat-card">
                  <i class="fas fa-repeat"></i>
                  <div class="stat-content">
                    <span class="stat-value">{{ getProgramStats()?.totalReps }}</span>
                    <span class="stat-label">Total Reps</span>
                  </div>
                </div>
                
                <div class="stat-card">
                  <i class="fas fa-weight-hanging"></i>
                  <div class="stat-content">
                    <span class="stat-value">{{ getProgramStats()?.totalVolume }}</span>
                    <span class="stat-label">Total Volume (kg)</span>
                  </div>
                </div>
                
                <div class="stat-card">
                  <i class="fas fa-pause"></i>
                  <div class="stat-content">
                    <span class="stat-value">{{ getProgramStats()?.averageRestTime }}</span>
                    <span class="stat-label">Avg Rest Time</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="stat-section">
              <h3>Exercise Distribution</h3>
              <div class="distribution-charts">
                <div class="chart-container">
                  <h4>Sets per Exercise</h4>
                  <div class="chart-bars">
                    <div 
                      *ngFor="let exercise of program.exercises; let i = index" 
                      class="chart-bar"
                      [style.height.px]="getBarHeight(exercise.sets, getMaxSets())"
                      [style.background-color]="getBarColor(i)"
                    >
                      <span class="bar-value">{{ exercise.sets }}</span>
                    </div>
                  </div>
                  <div class="chart-labels">
                    <span *ngFor="let exercise of program.exercises" class="chart-label">
                      {{ exercise.order }}
                    </span>
                  </div>
                </div>

                <div class="chart-container">
                  <h4>Volume per Exercise</h4>
                  <div class="chart-bars">
                    <div 
                      *ngFor="let exercise of program.exercises; let i = index" 
                      class="chart-bar"
                      [style.height.px]="getBarHeight(exercise.sets * exercise.reps * exercise.weight, getMaxVolume())"
                      [style.background-color]="getBarColor(i)"
                    >
                      <span class="bar-value">{{ exercise.sets * exercise.reps * exercise.weight }}</span>
                    </div>
                  </div>
                  <div class="chart-labels">
                    <span *ngFor="let exercise of program.exercises" class="chart-label">
                      {{ exercise.order }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="stat-section" *ngIf="getWorkoutHistory().length > 0">
              <h3>Performance Trends</h3>
              <div class="performance-metrics">
                <div class="metric-card">
                  <div class="metric-header">
                    <i class="fas fa-trending-up"></i>
                    <span>Completion Rate</span>
                  </div>
                  <div class="metric-value">{{ getAverageCompletionRate() }}%</div>
                  <div class="metric-trend">
                    <span class="trend-label">Last 5 workouts</span>
                  </div>
                </div>
                
                <div class="metric-card">
                  <div class="metric-header">
                    <i class="fas fa-clock"></i>
                    <span>Average Duration</span>
                  </div>
                  <div class="metric-value">{{ getAverageWorkoutDuration() }}</div>
                  <div class="metric-trend">
                    <span class="trend-label">Actual vs Estimated</span>
                  </div>
                </div>
                
                <div class="metric-card">
                  <div class="metric-header">
                    <i class="fas fa-calendar"></i>
                    <span>Workout Frequency</span>
                  </div>
                  <div class="metric-value">{{ getWorkoutFrequency() }}</div>
                  <div class="metric-trend">
                    <span class="trend-label">Per week</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- History Tab -->
        <div *ngIf="selectedTab === 'history'" class="tab-pane">
          <div class="history-container" *ngIf="getWorkoutHistory().length > 0; else noHistory">
            <div class="history-header">
              <h3>Workout History</h3>
              <div class="history-filters">
                <select class="form-select" [(ngModel)]="historyFilter" (change)="filterHistory()">
                  <option value="all">All Workouts</option>
                  <option value="completed">Completed</option>
                  <option value="partial">Partial</option>
                </select>
              </div>
            </div>

            <div class="history-list">
              <div *ngFor="let workout of filteredHistory" class="history-item">
                <div class="history-date">
                  <div class="date-main">{{ workout.date | date:'MMM dd' }}</div>
                  <div class="date-year">{{ workout.date | date:'yyyy' }}</div>
                </div>
                <div class="history-content">
                  <div class="history-stats">
                    <span class="stat">
                      <i class="fas fa-check-circle"></i>
                      {{ workout.completedExercises }}/{{ workout.totalExercises }} exercises
                    </span>
                    <span class="stat">
                      <i class="fas fa-clock"></i>
                      {{ workout.duration }}
                    </span>
                    <span class="stat">
                      <i class="fas fa-percentage"></i>
                      {{ workout.completionRate }}% complete
                    </span>
                  </div>
                  <div class="history-actions">
                    <button class="btn btn-sm btn-outline-primary" (click)="viewWorkoutDetails(workout)">
                      <i class="fas fa-eye"></i> Details
                    </button>
                  </div>
                </div>
                <div class="history-status" [class]="workout.status">
                  <i class="fas" [class.fa-check-circle]="workout.status === 'completed'" [class.fa-clock]="workout.status === 'partial'"></i>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noHistory>
            <div class="history-placeholder">
              <i class="fas fa-chart-line"></i>
              <h3>No Workout History</h3>
              <p>Start your first workout to begin tracking your progress.</p>
              <button class="btn btn-primary" (click)="onStartWorkout()">
                <i class="fas fa-play"></i> Start First Workout
              </button>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <app-confirm-dialog
    [isVisible]="showDeleteDialog"
    [data]="deleteDialogData"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()"
    (close)="closeDeleteDialog()">
  </app-confirm-dialog>

  <!-- Duplicate Program Dialog -->
  <app-duplicate-program-dialog
    [isVisible]="showDuplicateDialog"
    [data]="duplicateDialogData"
    (confirm)="onConfirmDuplicate($event)"
    (cancel)="onCancelDuplicate()"
    (close)="closeDuplicateDialog()">
  </app-duplicate-program-dialog>
</div>
